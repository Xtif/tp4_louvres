{% extends '::layout.html.twig' %}


{% block body %}


<!--Fil d'arianne-->

	<nav aria-label="breadcrumb" role="navigation">
	  <ol class="breadcrumb rounded-0">
	    <li class="breadcrumb-item active" aria-current="page"><a href="#">Réservation</a></li>
	    <li class="breadcrumb-item">Billets</li>
	    <li class="breadcrumb-item">Récapitulatif</li>
	    <li class="breadcrumb-item">Paiement</li>
	    <li class="breadcrumb-item">Validation</li>
	  </ol>
	</nav>




<!--Formulaire-->
<div class="col-8 m-auto">
	<h1 class="mt-3">Réservation de billets</h1>
	<p>Le musée est ouvert tous les jours sauf les mardis, le 1er mai, le 1er novembre et le 25 décembre.<br/>
	Les réservations ne sont pas possibles pour les dimanche et jours fériés, veuillez vous rendre directement au guichet du musée pour ces jours ci.</p>





{{ form_start(form) }}

{# Erreurs générales #}
{{ form_errors(form) }} 

{# Champs du formulaire #}
<div class="form-group">
	{# Génération du label #}
	{{ form_label(form.jour, "Date de visite") }}
	{# Génération de l'input #}
	{{ form_widget(form.jour, {'attr': {'class': 'col-3 p-0'}}) }}
	{# Affichage des erreurs liées au champ #}
	{{ form_errors(form.jour) }}
</div>

<p id="messageBilletsRestant">Il reste <span id="nbreBilletsRestant"></span> billets disponibles pour cette date.</p>

<div class="form-group">
	{# Génération du label #}
	{{ form_label(form.nom_reservation, "Nom de la réservation") }}
	{# Génération de l'input #}
	{{ form_widget(form.nom_reservation) }}
	{# Affichage des erreurs liées au champ #}
	{{ form_errors(form.nom_reservation) }}
</div>

<div class="form-group">
	{# Génération du label #}
	{{ form_label(form.prenom_reservation, "Prénom de la réservation") }}
	{# Génération de l'input #}
	{{ form_widget(form.prenom_reservation) }}
	{# Affichage des erreurs liées au champ #}
	{{ form_errors(form.prenom_reservation) }}
</div>

<div class="form-group">
	{# Génération du label #}
	{{ form_label(form.email, "Email de la réservation") }}
	{# Génération de l'input #}
	{{ form_widget(form.email) }}
	{# Affichage des erreurs liées au champ #}
	{{ form_errors(form.email) }}
</div>

<div class="form-group">
	{{ form_widget(form.submit, {'attr': {'class': 'bg-info bouton-formulaire'}, 'id': 'bouton-valider', 'label': 'Valider'}) }}
</div>


	{{ form_rest(form) }}

{{ form_end(form) }}



</div>

<script type="text/javascript" src="../../web/bundles/form/js/page_reservation_script.js"></script>

<script>

function checkBilletsRestant(dateSelectionnee) { // On check dans la BDD le nbre de billets restant
	$.ajax({
		type: "GET",
		url: "{{ (path('check_nombre_billets_restant')) }}",
		data: { "date": dateSelectionnee },
		dataType: "json",
		success: function(data) {
			if (data.nbreBilletsRestant > 0) {	
				$("#nbreBilletsRestant").html(data.nbreBilletsRestant);
			} else {
				$("#messageBilletsRestant").css('color', 'red');
				$("#bouton-valider").attr('disabled', 'disabled').removeClass('bg-info').addClass('bg-secondary');
				$("#messageBilletsRestant").html("Nous sommes désolé, il n'y a plus de billets pour cette date.");
			}
			$("#messageBilletsRestant").css('display', 'block');
		},
		error: function() {
			$("#messageBilletsRestant").html("Une erreur s'est produite, nous ne pouvons pas vous donner le nombre de billets restant pour cette date.");
		},
		// complete: function() {
		// 	console.log("terminée");
		// }
	});
}

</script>


{% endblock %}